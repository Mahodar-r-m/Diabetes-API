<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TensorflowJS</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@2.0.0/dist/tf.min.js"></script>
</head>
<body>
    <h1>TensorflowJS API Prediction</h1>
    <input id="pred">
    <script>
        console.log("Started")
        async function loadModel(){
            //import * as tf from '@tensorflow/tfjs';
            const model = await tf.loadLayersModel('model.json');
            
            // Getting Parameter Values
            var url = window.location.href
            //console.log(url);
            var url = new URL(url);
            var Pregnancies = parseFloat(url.searchParams.get("Pregnancies"));
            var Glucose = parseFloat(url.searchParams.get("Glucose"));
            var BloodPressure = parseFloat(url.searchParams.get("BloodPressure"));
            var SkinThickness = parseFloat(url.searchParams.get("SkinThickness"));
            var Insulin = parseFloat(url.searchParams.get("Insulin"));
            var BMI = parseFloat(url.searchParams.get("BMI"));
            var DiabetesPedigreeFunction = parseFloat(url.searchParams.get("DiabetesPedigreeFunction"));
            var Age = parseFloat(url.searchParams.get("Age"));
            //console.log(Pregnancies);
            //console.log(Glucose);
            // Reference : https://stackoverflow.com/questions/979975/how-to-get-the-value-from-the-get-parameters
            // End Getting Parameter Values

            document.getElementById('pred').value = model.predict(tf.tensor2d([
                [
                    Pregnancies,
                    Glucose,
                    BloodPressure,
                    SkinThickness,
                    Insulin,
                    BMI,
                    DiabetesPedigreeFunction,
                    Age
                ]
            ]));
            
            // Testing
            console.log(model.predict(tf.tensor2d([
                [
                    Pregnancies,
                    Glucose,
                    BloodPressure,
                    SkinThickness,
                    Insulin,
                    BMI,
                    DiabetesPedigreeFunction,
                    Age
                ]
            ])));

            //const prediction = model.predict(tf.tensor2d([[3,126,88,41,235,39.3,0.704,27]])).print(); // 0
            //const prediction = model.predict(tf.tensor2d([[1,103,30,38,83,43.3,0.183,33]])).print(1); // 1
            //console.log(prediction)
            var valuePred = Math.round(document.getElementById('pred').value.slice(13,19));
            console.log("Prediction = "+valuePred);

            // Redirect to Prediction
            // location.replace(window.location.protocol+"//"+window.location.hostname+window.location.pathname+"?Prediction="+valuePred)
            //location.replace("https://mahodar-r-m.github.io/Diabetes-API/index.html?Prediction="+valuePred); // Working
        }
        // Checking
        var url = window.location.href;
        var arr = url.split('=');
        console.log(arr.length)
        // Reference : https://stackoverflow.com/questions/32046990/count-the-number-of-parameters-in-query-string
        if(arr.length == 9){
            loadModel()
        }else if(arr.length == 2){
            console.log("Success");
        }else{
            document.getElementById('pred').value="Prediction Done";
        }
    </script>
</body>
</html>
